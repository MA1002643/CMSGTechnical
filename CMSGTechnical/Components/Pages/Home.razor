@page "/"
@using CMSGTechnical.Code
@using CMSGTechnical.Domain.Models
@using CMSGTechnical.Mediator.Menu
@using MediatR
@using CMSGTechnical.Components.Shared
@using CMSGTechnical.Mediator.Dtos
@using System.Text.Json

<PageTitle>Home</PageTitle>

@foreach (var group in MenuItems
.GroupBy(m => m.Category) // group menu items by category
.OrderBy(g => (int)g.Key)) // order categories for display
{

    <h5 class="mt-3"></h5>

    @foreach (var item in group.OrderBy(m => m.Price)) // display items sorted by price.
    {
        <MenuItemDisplay @key="item.Id" Item="@item" OnAdd="() => AddItem(item.Id)" />
    }
}

@code
{
    [Inject] private IMediator Mediator { get; set; } = default!;


    private MenuItemDto[] MenuItems { get; set; } = Array.Empty<MenuItemDto>();
    [CascadingParameter]
    private BasketService Basket { get; set; }


    protected override async Task OnInitializedAsync()
    {
        MenuItems = (await Mediator.Send(new GetMenuItems())).ToArray();
    }

    private void AddItem(int id)
    {
        var menuItem = MenuItems.First(i => i.Id == id);
        Basket.Add(menuItem);

    }

}